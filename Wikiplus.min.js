/**
 * Wikiplus-3.0 v0.0.1
 * 2016-02-09
 * 
 * Github:https://github.com/Wikiplus/Wikiplus-3.0
 *
 * Include MoeNotification
 * https://github.com/Wikiplus/MoeNotification
 *
 * Copyright by Wikiplus, Eridanus Sora, Ted Zyzsdy and other contributors
 * Licensed by Apache License 2.0
 * http://wikiplus-app.smartgslb.com/
 */
 !function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Wikiplus=void 0;var g=a("./i18n"),h=d(g),i=a("./version"),j=a("./util"),k=a("./ui"),l=a("./moduleManager");c.Wikiplus=function(){function a(b){e(this,a),this.UI=k.UI,this.Util=j.Util,this.Version=i.Version,this.notice=b,console.log("Wikiplus-3.0 v"+i.Version.VERSION),j.Util.loadCss(i.Version.scriptURL+"/Wikiplus.css"),this.checkInstall()}return f(a,[{key:"start",value:function(){this.mmr=new l.ModuleManager,this.notice.create.success((0,h["default"])("Test Run"))}},{key:"checkInstall",value:function(){var a=this,b=j.Util.getLocalConfig("isInstall");"True"===b?j.Util.getLocalConfig("Version")!==i.Version.VERSION&&(this.notice.create.success("Wikiplus-3.0 v"+i.Version.VERSION),this.notice.create.success(i.Version.releaseNote),j.Util.setLocalConfig("Version",i.Version.VERSION)):!function(){var b=function(){j.Util.setLocalConfig("isInstall","True"),j.Util.setLocalConfig("Version",i.Version.VERSION),j.Util.setLocalConfig("StartUseAt",(new Date).valueOf()),j.Util.setLocalConfig("StartEditCount",mw.config.values.wgUserEditCount),a.notice.create.success((0,h["default"])("Wikiplus installed, enjoy it"))};k.UI.createDialog({title:(0,h["default"])("Install Wikiplus"),info:(0,h["default"])("Do you allow WikiPlus to collect insensitive data to help us develop WikiPlus and improve suggestion to this site: $1 ?").replace(/\$1/gi,mw.config.values.wgSiteName),mode:[{id:"Yes",text:(0,h["default"])("Yes"),res:!0},{id:"No",text:(0,h["default"])("No"),res:!1}]}).then(function(a){console.log("用户选择："+(a?"接受":"拒绝")),j.Util.setLocalConfig("SendStatistics",a?"True":"False"),b()})}()}}]),a}()},{"./i18n":2,"./moduleManager":4,"./ui":6,"./util":7,"./version":8}],2:[function(a,b,c){"use strict";function d(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0];arguments.length<=1||void 0===arguments[1]?"default":arguments[1],arguments.length<=2||void 0===arguments[2]?"default":arguments[2];return a}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d},{}],3:[function(a,b,c){"use strict";var d=a("./core"),e=a("./moenotice");$(function(){var a=new e.MoeNotification,b=window.Wikiplus=new d.Wikiplus(a);console.log("Wikiplus 开始加载"),b.start()})},{"./core":1,"./moenotice":5}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.ModuleManager=void 0;var f=a("./version"),g=a("./util");c.ModuleManager=function(){function a(){d(this,a),this.modulesConfig=g.Util.getLocalConfig("modules",!0),void 0==this.modulesConfig&&(this.modulesConfig=[]),this.modules={};var b=!0,c=!1,e=void 0;try{for(var f,h=this.modulesConfig[Symbol.iterator]();!(b=(f=h.next()).done);b=!0){var i=f.value;this.loadModule(i)}}catch(j){c=!0,e=j}finally{try{!b&&h["return"]&&h["return"]()}finally{if(c)throw e}}}return e(a,[{key:"loadModule",value:function(a){var b="_wikiplus_mmr_cb"+(new Date).getTime(),c=this;window[b]=function(d){c.loadModuleHelper(d,a,c),delete window[b]};var d=f.Version.scriptURL+"/backend/getmodule?name="+a+"&callback="+b;g.Util.loadJs(d)}},{key:"loadModuleHelper",value:function(a,b,c){var d=c.modules;if(void 0==a.manifest)console.error("无法解析模块 "+b);else if(a.manifest.name==b){console.log("加载 "+a.manifest.name+" 版本 "+a.manifest.version+" 成功。"),d[b]=a;var e=!0,f=!1,g=void 0;try{for(var h,i=a.manifest.dependencies[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;-1==c.modulesConfig.indexOf(j)&&(c.modulesConfig.push(j),console.log("准备加载"+b+"的额外依赖: "+j),c.loadModule(j))}}catch(k){f=!0,g=k}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}this.modulesInit()}else console.error("载入模块失败："+b)}},{key:"modulesInit",value:function(){for(var a in this.modules){var b=this.modules[a];if("loaded"!=b.__wikiplus_mmr_init_status&&"skipped"!=b.__wikiplus_mmr_init_status){console.log("初始化模块: "+a);var c=!0,d={},e=!0,f=!1,g=void 0;try{for(var h,i=b.manifest.dependencies[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;if(void 0==this.modules[j]){c=!1;break}d[j]=this.modules[j]}}catch(k){f=!0,g=k}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}c?b.init(b,d)?(console.log("模块"+a+"初始化成功。"),b.__wikiplus_mmr_init_status="loaded"):(console.log("模块"+a+"认为它自己不应该被初始化。"),b.__wikiplus_mmr_init_status="skipped"):console.log("模块"+a+"依赖不满足，等待下次再初始化。")}}}}]),a}()},{"./util":7,"./version":8}],5:[function(a,b,c){"use strict";function d(){var a=this;this.display=function(){var b=arguments.length<=0||void 0===arguments[0]?"喵":arguments[0],c=arguments.length<=1||void 0===arguments[1]?"success":arguments[1],d=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];$("#MoeNotification").append($("<div>").addClass("MoeNotification-notice").addClass("MoeNotification-notice-"+c).append($("<span>").text(b)).fadeIn(300)),a.bind(),a.clear(),d($("#MoeNotification").find(".MoeNotification-notice").last())},this.create={success:function(b){var c=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a.display(b,"success",c)},warning:function(b){var c=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a.display(b,"warning",c)},error:function(b){var c=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];a.display(b,"error",c)}},this.clear=function(){return $(".MoeNotification-notice").length>=10?($("#MoeNotification").children().first().fadeOut(150,function(){$(this).remove()}),void setTimeout(a.clear,300)):!1},this.empty=function(a){$(".MoeNotification-notice").each(function(b){if($.isFunction(a)){var c=this;setTimeout(function(){a($(c))},200*b)}else $(this).delay(200*b).fadeOut("fast",function(){$(this).remove()})})},this.bind=function(){$(".MoeNotification-notice").mouseover(function(){a.slideLeft($(this))})},window.slideLeft=this.slideLeft=function(a,b){a.css("position","relative"),a.animate({left:"-200%"},b||150,function(){$(this).fadeOut("fast",function(){$(this).remove()})})},this.init=function(){$("body").append($("<div>").attr("id","MoeNotification"))},$("#MoeNotification").length>0||this.init()}Object.defineProperty(c,"__esModule",{value:!0}),c.MoeNotification=d},{}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.UI=void 0;var g=a("./i18n"),h=d(g);c.UI=function(){function a(){e(this,a)}return f(a,null,[{key:"createDialog",value:function(b){var c=b.info||"",d=b.title||(0,h["default"])("Wikiplus"),e=b.mode||[{id:"Yes",text:(0,h["default"])("Yes"),res:!0},{id:"No",text:(0,h["default"])("No"),res:!1}];return new Promise(function(b,f){var g=$("<div>").text(c).attr("id","Wikiplus-InterBox-Content"),h=$("<div>").append(g).append($("<hr>")),i=!0,j=!1,k=void 0;try{for(var l,m=e[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=$("<div>").addClass("Wikiplus-InterBox-Btn").attr("id","Wikiplus-InterBox-Btn"+n.id).text(n.text).data("value",n.res);h.append(o)}}catch(p){j=!0,k=p}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}a.createBox({title:d,content:h,callback:function(){var c=!0,d=!1,f=void 0;try{for(var g,h=function(){var c=g.value;$("#Wikiplus-InterBox-Btn"+c.id).click(function(){var d=$("#Wikiplus-InterBox-Btn"+c.id).data("value");a.closeBox(),b(d)})},i=e[Symbol.iterator]();!(c=(g=i.next()).done);c=!0)h()}catch(j){d=!0,f=j}finally{try{!c&&i["return"]&&i["return"]()}finally{if(d)throw f}}}})})}},{key:"closeBox",value:function(){$(".Wikiplus-InterBox").fadeOut("fast",function(){$(this).remove()})}},{key:"createBox",value:function(a){var b=a.title||(0,h["default"])("Wikiplus"),c=a.content||"",d=a.width||600,e=a.callback||new Function;$(".Wikiplus-InterBox").length>0&&$(".Wikiplus-InterBox").each(function(){$(this).remove()});var f=document.body.clientWidth,g=document.body.clientHeight,i=$("<div>").addClass("Wikiplus-InterBox").css({"margin-left":f/2-d/2+"px",top:$(document).scrollTop()+.2*g,display:"none"}).append($("<div>").addClass("Wikiplus-InterBox-Header").html(b)).append($("<div>").addClass("Wikiplus-InterBox-Content").append(c)).append($("<span>").text("×").addClass("Wikiplus-InterBox-Close"));$("body").append(i),$(".Wikiplus-InterBox").width(d+"px"),$(".Wikiplus-InterBox-Close").click(function(){$(this).parent().fadeOut("fast",function(){window.onclose=window.onbeforeunload=void 0,$(this).remove()})});var j=function k(a){a.mousedown(function(b){var c=b.clientX,d=b.clientY,e=a.parent().offset().left,f=a.parent().offset().top;$(document).mousemove(function(b){a.parent().css({"margin-left":e+b.clientX-c,top:f+b.clientY-d})}),$(document).mouseup(function(){a.unbind("mousedown"),$(document).unbind("mousemove"),$(document).unbind("mouseup"),k(a)})})};j($(".Wikiplus-InterBox-Header")),$(".Wikiplus-InterBox").fadeIn(500),e()}}]),a}()},{"./i18n":2}],7:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0});c.Util=function(){function a(){d(this,a)}return e(a,null,[{key:"loadCss",value:function(a){var b=document.createElement("link");$(b).attr({rel:"stylesheet",type:"text/css",href:a}),$("head").append(b)}},{key:"loadJs",value:function(a){var b=document.createElement("script");$(b).attr({type:"text/javascript",async:!1,src:a}),$("head").append(b)}},{key:"setLocalConfig",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];a="Wikiplus-"+a,c?localStorage[a]=JSON.stringify(b):localStorage[a]=b}},{key:"getLocalConfig",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return a="Wikiplus-"+a,b?JSON.parse(localStorage[a]):localStorage[a]}}]),a}()},{}],8:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=c.Version=function f(){d(this,f)};e.VERSION="0.0.4",e.releaseNote="mmr这就差不多了吧。",e.scriptURL="https://127.0.0.1"},{}]},{},[3]);